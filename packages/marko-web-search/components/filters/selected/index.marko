import gql from "graphql-tag";
import { get, getAsArray, getAsObject } from "@parameter1/base-cms-object-path";

$ const { $markoWebSearch: search, i18n } = out.global;
$ const blockName = "marko-web-search-selected-filters";
$ const { contentTypes, assignedToWebsiteSectionIds } = search.input;
$ const { contentTypeObjectMap } = search.config;

$ const queryFragment = gql`
  fragment MarkoWebSearchSelectedWebsiteSectionFragment on WebsiteSection {
    id
    fullName
  }
`;

$ const hasFilters = !search.isDefaultInputValueFor("contentTypes") || assignedToWebsiteSectionIds.length;

<if(hasFilters)>
  <marko-web-block name=blockName>
    <if(!search.isDefaultInputValueFor("contentTypes"))>
      <for|contentTypeId| of=contentTypes>
        $ const contentType = contentTypeObjectMap.get(contentTypeId);
        <marko-web-search-selected-filter
          prefix=`${i18n("Type")}`
          filter-key="contentTypes"
          label=`${i18n(contentType.label)}`
          />
      </for>
    </if>
    <if(assignedToWebsiteSectionIds.length)>
      <marko-web-query-website-sections|{ nodes }|
        include-ids=assignedToWebsiteSectionIds
        limit=assignedToWebsiteSectionIds.length
        query-fragment=queryFragment
      >
        <for|section| of=nodes>
          <marko-web-search-selected-filter
            prefix=`${i18n("Section")}`
            filter-key="assignedToWebsiteSectionIds"
            label=section.fullName
          />
        </for>
      </marko-web-query-website-sections>
    </if>
  </marko-web-block>
</if>
